(()=>{"use strict";var e=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function d(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};const t="http://localhost:3000/";function n(n,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{headers:{Authorization:`Bearer ${r}`}});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error fetching data from API",e),{success:!1,error:{message:"An error occurred while fetching data."}}}}))}var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function d(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};function o(e){return r(this,void 0,void 0,(function*(){return yield n("user",e)}))}function i(n,r="auth/validate"){return o=this,i=void 0,d=function*(){const o={token:n};return yield function(n,r,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:r?JSON.stringify(r):void 0});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error posting data to API",e),{success:!1,error:{message:`An error occurred while connecting to the API: ${e.message||"Unknown error"}`}}}}))}(r,o)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{s(d.next(e))}catch(e){t(e)}}function r(e){try{s(d.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(n,r)}s((d=d.apply(o,i||[])).next())}));var o,i,a,d}const a=(e="token")=>{return t=void 0,n=void 0,o=function*(){const t=localStorage[e];if(t)try{const e=yield i(t);return!0===e.success?!0===(yield e.data).valid:(console.error("Error validating token:",e.error),!1)}catch(e){return console.error("Error validating token:",e),!1}return!1},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function d(e){try{s(o.throw(e))}catch(e){i(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,d)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o};var d=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function d(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};const s=(e,t,n)=>{const r=document.createElement("a");return r.classList.add("block","px-4","py-2","text-sm","text-gray-700"),r.setAttribute("href",t),r.setAttribute("role","menuitem"),r.setAttribute("tabindex","-1"),r.setAttribute("id",n),r.innerText=e,r},c=()=>d(void 0,void 0,void 0,(function*(){const e=localStorage.getItem("token"),t=yield o(e);if(t.success){const e=t.data;if(e&&"admin"===e.role)return!0}return!1})),l=()=>d(void 0,void 0,void 0,(function*(){localStorage.removeItem("token"),window.location.href="/account/login.html"}));function u(e,t,n){e.innerHTML=`<div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4" role="alert">\n    <p class="font-bold">${n||"Error"}</p>\n    <p>${t}</p>\n  </div>`,setTimeout((()=>v(e)),3e3)}function m(e,t){e.innerHTML=`<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4" role="alert">\n    <p class="font-bold">Success</p>\n    <p>${t}</p>\n  </div>`,setTimeout((()=>v(e)),3e3)}function v(e){e.innerHTML=""}var y=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function d(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((r=r.apply(e,t||[])).next())}))};function g(){const e=new Event("DOMContentLoaded");document.dispatchEvent(e)}document.addEventListener("DOMContentLoaded",(()=>y(void 0,void 0,void 0,(function*(){d(void 0,void 0,void 0,(function*(){const e=document.querySelector("#user-menu-list");if(e)if(e.innerHTML="",yield a()){const t=window.location.pathname.includes("login.html"),n=window.location.pathname.includes("signup.html");let r;r=(yield c())?"/admin":"/user",(t||n)&&(window.location.href=r),e.appendChild(s("Your Dashboard",r,"user-menu-item-0")),e.appendChild(s("Logout","account/login.html","user-menu-item-2"));const o=document.querySelector("#user-menu-item-2");o&&o.addEventListener("click",(e=>{e.preventDefault(),l()}))}else document.querySelectorAll(".login-required").forEach((e=>{e.setAttribute("href","/account/login.html")})),e.appendChild(s("Sign In","/account/login.html","user-menu-item-0")),e.appendChild(s("Create Account","/account/signup.html","user-menu-item-1"))})),(()=>{const e=document.querySelector("#user-menu"),t=document.querySelector("#user-menu-list");e&&t&&e.addEventListener("click",(()=>{t.classList.toggle("hidden")}));const n=document.querySelector("#mobile-menu"),r=document.querySelector("#menu-toggle"),o=document.querySelector("#menu-close-btn"),i=document.querySelector("#menu-show-btn");r&&n&&o&&i&&r.addEventListener("click",(()=>{n.classList.toggle("hidden"),o.classList.toggle("hidden"),i.classList.toggle("hidden")}))})(),(yield a())||(window.location.href="/account/login.html");const i=localStorage.getItem("token"),v=yield function(e){return r(this,void 0,void 0,(function*(){return yield n("user/booking",e)}))}(i);let f='\n    <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">\n        <div class="px-4 py-5 sm:p-6">\n            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">\n                No Events Booked\n            </h3>\n            <div class="mt-2 max-w-xl text-sm text-gray-500 dark:text-gray-400">\n                <p>\n                    You have not booked any events yet. Please visit the events page to book an event.\n                </p>\n            </div>\n        </div>\n    ';v&&v.success&&v.data.length>0&&(f=v.data.map((e=>function(e){const t=e.event;return`\n        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-0">\n            <div id="separation-line" class="border-8 border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-0"></div>\n            <dl class="sm:divide-y sm:divide-gray-200 dark:divide-gray-700">\n                <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">\n                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">\n                        Event Name\n                    </dt>\n                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2">\n                        <a href="/bookings?id=${e.id}" class="text-blue-500 hover:text-blue-700">${t.eventName}</a>\n                    </dd>\n                </div>\n\n                <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">\n                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">\n                        Event Date\n                    </dt>\n                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2">\n                        ${t.eventDate}\n                    </dd>\n                </div>\n\n                <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">\n                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">\n                        Event Venue\n                    </dt>\n                    <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2">\n                        ${t.location}\n                    </dd>\n                </div>\n            </dl>\n        </div>\n    `}(e))).join(""));const h=document.getElementById("eventsContainer");h&&(h.innerHTML=f);const p=yield o(i);let b;b=p.success?p.data:{firstName:"unable to retrieve data",lastName:"unable to retrieve data",email:"unable to retrieve data"};const x=function(e){const{firstName:t,lastName:n,email:r}=e;return`\n        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-0">\n            <dl class="sm:divide-y sm:divide-gray-200 dark:divide-gray-700">\n                ${[{label:"First Name",id:"firstName",value:t,disabled:""},{label:"Last Name",id:"lastName",value:n,disabled:""},{label:"Email address",id:"email",value:r,disabled:"disabled"},{label:"New Password",id:"password",value:"",type:"password",disabled:""}].map((e=>`\n        <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">\n            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">${e.label}</dt>\n            <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2">\n                <input type="${e.type||"text"}" name="${e.id}" id="${e.id}"\n                    value="${e.value}" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg\n                    focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600\n                    dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"\n                    placeholder="${e.label}" ${e.disabled}>\n            </dd>\n        </div>\n    `)).join("")}\n            </dl>\n            \n        <div class="justify-center self-auto px-4 py-3 flex bg-gray-50 dark:bg-gray-800 text-right sm:px-6">\n            <button id="editUserBtn" type="button"\n                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save\n            </button>\n        </div>\n    \n        </div>\n    `}(b),w=document.getElementById("accountContainer");w?w.innerHTML=x:console.log("accountDetailsContainer not found");const k=document.getElementById("editUserBtn");k?k.addEventListener("click",(()=>y(void 0,void 0,void 0,(function*(){const n=document.getElementById("firstName").value,o=document.getElementById("lastName").value,i=document.getElementById("email").value,a=document.getElementById("password").value;let d;d=a?{firstName:n,lastName:o,email:i,password:a}:{firstName:n,lastName:o,email:i};const s=localStorage.getItem("token"),c=yield function(n,o){return r(this,void 0,void 0,(function*(){return yield function(n,r,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}user`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(r)});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error patching data to API",e),{success:!1,error:{message:"An error occurred while updating."}}}}))}(0,n,o)}))}(d,s);c.success?(m(document.querySelector("#errorContainer"),"User Detail Updated Successfully!"),g()):u(document.querySelector("#errorContainer"),c.error.message||"User Detail Update Failed! ")})))):console.log("editUserBtn not found");const E=document.getElementById("deleteAccountBtn");E&&E.addEventListener("click",(()=>y(void 0,void 0,void 0,(function*(){const n=yield function(n){return r(this,void 0,void 0,(function*(){return yield function(n,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}user`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});return e.ok?{success:!0}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error deleting data from API",e),{success:!1,error:{message:"An error occurred while deleting data."}}}}))}(0,n)}))}(i);n.success?(m(document.querySelector("#errorContainer"),"User Deleted Successfully! Redirecting to login page..."),localStorage.removeItem("token"),setTimeout((()=>{window.location.href="/account/login.html"}),3e3)):(u(document.querySelector("#errorContainer"),n.error.message||"User Delete Failed! "),g())}))))}))))})();