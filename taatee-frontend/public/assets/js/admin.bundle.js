(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};const t="http://localhost:3000/";function n(n,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{headers:{Authorization:`Bearer ${o}`}});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error fetching data from API",e),{success:!1,error:{message:"An error occurred while fetching data."}}}}))}function o(n,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});return e.ok?{success:!0}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error deleting data from API",e),{success:!1,error:{message:"An error occurred while deleting data."}}}}))}function r(n,o,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:o?JSON.stringify(o):void 0});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error posting data to API",e),{success:!1,error:{message:`An error occurred while connecting to the API: ${e.message||"Unknown error"}`}}}}))}function i(n,o,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(o)});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error patching data to API",e),{success:!1,error:{message:"An error occurred while updating."}}}}))}var d=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};function c(e){return d(this,void 0,void 0,(function*(){return yield n("user",e)}))}const a=(e="token")=>{return t=void 0,n=void 0,i=function*(){const t=localStorage[e];if(t)try{const e=yield function(e,t="auth/validate"){return n=this,o=void 0,d=function*(){const n={token:e};return yield r(t,n)},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{a(d.next(e))}catch(e){t(e)}}function c(e){try{a(d.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}a((d=d.apply(n,o||[])).next())}));var n,o,i,d}(t);return!0===e.success?!0===(yield e.data).valid:(console.error("Error validating token:",e.error),!1)}catch(e){return console.error("Error validating token:",e),!1}return!1},new((o=void 0)||(o=Promise))((function(e,r){function d(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(d,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i};var s=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};const l=(e,t,n)=>{const o=document.createElement("a");return o.classList.add("block","px-4","py-2","text-sm","text-gray-700"),o.setAttribute("href",t),o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.setAttribute("id",n),o.innerText=e,o},u=()=>s(void 0,void 0,void 0,(function*(){const e=localStorage.getItem("token"),t=yield c(e);if(t.success){const e=t.data;if(e&&"admin"===e.role)return!0}return!1})),m=()=>s(void 0,void 0,void 0,(function*(){localStorage.removeItem("token"),window.location.href="/account/login.html"}));function v(e,t,n){e.innerHTML=`<div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4" role="alert">\n    <p class="font-bold">${n||"Error"}</p>\n    <p>${t}</p>\n  </div>`,setTimeout((()=>f(e)),3e3)}function g(e,t){e.innerHTML=`<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4" role="alert">\n    <p class="font-bold">Success</p>\n    <p>${t}</p>\n  </div>`,setTimeout((()=>f(e)),3e3)}function f(e){e.innerHTML=""}var y=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};function h(e,t,n){return y(this,void 0,void 0,(function*(){return yield i(`event/${e}`,t,n)}))}function p(e){return{isValid:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e),error:"Invalid email address"}}function E(e){return{isValid:e.length>6,error:"Password must be at least 6 characters"}}const b=function(e,t){const n=[],o=p("test@example.com");n.push(o);const r=E("password123");return n.push(r),n}();console.log("Login Form Validation Results:",b);const w=function(e,t,n){const o=[],r=p("newuser@example.com");o.push(r);const i=E("securePassword123");o.push(i);const d={isValid:""!=="securePassword1234".trim(),error:"This field is required"};return o.push(d),o}();console.log("Registration Form Validation Results:",w);var x=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};function C(e,t){const n=document.createElement("a");return n.classList.add("font-medium","text-blue-600","dark:text-blue-500","hover:underline","px-2","cursor-default"),"Delete"===e&&(n.classList.add("cursor-pointer","text-red-600"),n.addEventListener("click",(e=>x(this,void 0,void 0,(function*(){e.preventDefault();const n=localStorage.getItem("token"),r=yield function(e,t){return y(this,void 0,void 0,(function*(){return yield o(`event/${e}`,t)}))}(t.id,n);r.success?(g(document.querySelector("#errorContainer"),"Event Deleted Successfully!"),k()):v(document.querySelector("#errorContainer"),r.error.message||"Event Deletion Failed! ")}))))),"Cancel"!==e&&"Activate"!==e||(n.classList.add("cursor-pointer"),n.addEventListener("click",(e=>x(this,void 0,void 0,(function*(){e.preventDefault();const n=localStorage.getItem("token"),o=yield function(e,t){return y(this,void 0,void 0,(function*(){const n=e.id,o={isCanceled:!e.isCanceled};return yield h(n,o,t)}))}(t,n);let r="Cancelled";r=o.data.isCancelled?"Activation":"Cancellation",o.success?(g(document.querySelector("#errorContainer"),`Event ${r} was Successful!`),k()):v(document.querySelector("#errorContainer"),o.error.message||`Event ${r} Failed!`)}))))),"Edit"===e&&(n.classList.add("editableEvent"),n.classList.add("cursor-pointer"),n.id=""+t.id),n.textContent=e,n}function k(){const e=new Event("DOMContentLoaded");document.dispatchEvent(e)}document.addEventListener("DOMContentLoaded",(()=>x(void 0,void 0,void 0,(function*(){if(s(void 0,void 0,void 0,(function*(){const e=document.querySelector("#user-menu-list");if(e)if(e.innerHTML="",yield a()){const t=window.location.pathname.includes("login.html"),n=window.location.pathname.includes("signup.html");let o;o=(yield u())?"/admin":"/user",(t||n)&&(window.location.href=o),e.appendChild(l("Your Dashboard",o,"user-menu-item-0")),e.appendChild(l("Logout","account/login.html","user-menu-item-2"));const r=document.querySelector("#user-menu-item-2");r&&r.addEventListener("click",(e=>{e.preventDefault(),m()}))}else document.querySelectorAll(".login-required").forEach((e=>{e.setAttribute("href","/account/login.html")})),e.appendChild(l("Sign In","/account/login.html","user-menu-item-0")),e.appendChild(l("Create Account","/account/signup.html","user-menu-item-1"))})),(()=>{const e=document.querySelector("#user-menu"),t=document.querySelector("#user-menu-list");e&&t&&e.addEventListener("click",(()=>{t.classList.toggle("hidden")}));const n=document.querySelector("#mobile-menu"),o=document.querySelector("#menu-toggle"),r=document.querySelector("#menu-close-btn"),i=document.querySelector("#menu-show-btn");o&&n&&r&&i&&o.addEventListener("click",(()=>{n.classList.toggle("hidden"),r.classList.toggle("hidden"),i.classList.toggle("hidden")}))})(),(yield a())||(window.location.href="/account/login.html"),!(yield u())){document.querySelectorAll("section").forEach((e=>{e.classList.add("blur")}));const e=document.querySelector("#errorContainer");e.classList.remove("blur"),v(e,"You are not an admin!","Access Denied"),setTimeout((()=>{window.location.href="/user"}),3e3)}const e=localStorage.getItem("token"),t=yield function(e){return d(this,void 0,void 0,(function*(){return yield n("user/all",e)}))}(e),f=document.getElementById("usersContainer");f?t.success&&t.data&&t.data.length>0?(f.innerHTML="",t.data.forEach((e=>{const t=function(e){const t=document.createElement("tr");t.classList.add("bg-white","border-b","dark:bg-gray-800","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-600");const n=document.createElement("th");n.setAttribute("scope","row"),n.classList.add("flex","items-center","px-6","py-2","font-medium","text-gray-900","whitespace-nowrap","dark:text-white");const o=document.createElement("div");o.classList.add("ps-3");const r=document.createElement("div");r.classList.add("text-base","font-semibold"),r.textContent=`${e.firstName} ${e.lastName}`;const i=document.createElement("div");i.classList.add("font-normal","text-gray-500"),i.textContent=e.email,o.appendChild(r),o.appendChild(i),n.appendChild(o);const d=document.createElement("td");d.classList.add("px-6","py-4","text-uppercase","font-semibold","text-gray-500","dark:text-gray-400"),d.textContent=e.role;const c=document.createElement("td");return c.classList.add("px-6","py-4"),c.textContent=e.numberOfbookings+"",t.appendChild(n),t.appendChild(d),t.appendChild(c),t}(e);f.appendChild(t)}))):v(document.querySelector("#errorContainer"),"Users List Not Found, Inform the Developer about this Bug Please!"):console.log("usersContainer not found");const p=yield function(){return y(this,void 0,void 0,(function*(){return yield n("event")}))}();let E;p&&p.success&&p.data&&p.data.length>0&&(E=p.data.map((t=>x(void 0,void 0,void 0,(function*(){const o=t.id,r=yield function(e,t){return y(this,void 0,void 0,(function*(){return yield n(`event/${e}/booking`,t)}))}(o,e);return r.success?t.booked=r.data.length:t.booked="-",function(e){const t=e.eventName;let n=e.eventDate;n=function(e,t=!1){const n=new Date(e);let o;return o=t?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(n):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(n),o}(n,!0);const o=e.location,r=!e.isCanceled,i=document.createElement("tr");[t,o,n,r,`${e.booked} / ${e.maxBooking}`].forEach((e=>{const t=document.createElement("td");t.classList.add("px-6","py-4","whitespace-nowrap"),"boolean"==typeof e?t.innerHTML=function(e,t){let n,o,r="Active",i="Cancelled";return t&&(r=t[0],i=t[1]),e?(n=r,o="green"):(n=i,o="red"),`\n    <div class="flex items-center">\n        <div class="h-2.5 w-2.5 rounded-full bg-${o}-500 me-2"></div> ${n}\n    </div>`}(e,["Active","Cancelled"]):t.textContent=e,i.appendChild(t)}));const d=document.createElement("td"),c=C("Edit",e),a=C("Delete",e);let s;return r?s=C("Cancel",e):(c.classList.add("hidden"),a.classList.add("hidden"),s=C("Activate",e)),d.appendChild(c),d.appendChild(a),d.appendChild(s),i.appendChild(d),i}(t)})))),E=yield Promise.all(E));const b=document.getElementById("eventsTableBody");b&&(E&&E.length>0?(b.innerHTML="",E.forEach((e=>{b.appendChild(e)}))):console.log("No events found"));const w=document.querySelector("#eventModal"),L=document.querySelector("#addEventBtn"),S=document.querySelector("#closeEventModalBtn"),B=document.querySelector("#eventModalForm");w&&L&&S&&B?(L.addEventListener("click",(()=>{w.classList.remove("hidden")})),S.addEventListener("click",(()=>{w.classList.add("hidden")})),window.addEventListener("click",(e=>{e.target===w&&w.classList.add("hidden")})),B.addEventListener("submit",(e=>x(void 0,void 0,void 0,(function*(){e.preventDefault();const t=document.getElementById("eventName").value,n=document.getElementById("eventDate").value,o=document.getElementById("eventLocation").value,i=document.getElementById("maxBooking").value,d=document.getElementById("eventDescription").value,c=parseInt(i,10);if(c<0)return void v(document.querySelector("#errorContainer"),"Max Booking cannot be negative!");if(0===c)return void v(document.querySelector("#errorContainer"),"Max Booking cannot be zero!");if(c>1e3)return void v(document.querySelector("#errorContainer"),"Max Booking cannot be greater than 1000!");const a={eventName:t,eventDate:n,description:d,location:o,maxBooking:c},s=localStorage.getItem("token"),l=yield function(e,t){return y(this,void 0,void 0,(function*(){return yield r("event",e,t)}))}(a,s);l.success?(g(document.querySelector("#errorContainer"),"Event Created Successfully!"),w.classList.add("hidden"),k()):v(document.querySelector("#errorContainer"),l.error.message||"Event Creation Failed! ")}))))):(console.log("modal or trigger or closeButton or eventModalForm not found"),console.log("modal "+w),console.log("trigger "+L),console.log("closeButton "+S),console.log("eventModalForm"+B),v(document.querySelector("#errorContainer"),"Form Not Properly Loaded, Inform the Developer about this Bug Please!"));const I=document.querySelector("#editEventModal"),q=document.querySelector(".editableEvent"),D=document.querySelector("#closeEditEventModalBtn"),$=document.querySelector("#editEventModalForm");if(I&&q&&D&&$){const e=document.querySelectorAll(".editableEvent");D.addEventListener("click",(()=>{I.classList.toggle("hidden")})),window.addEventListener("click",(e=>{e.target===I&&I.classList.toggle("hidden")})),e.forEach((e=>{e.addEventListener("click",(t=>x(void 0,void 0,void 0,(function*(){t.preventDefault();const o=parseInt(e.id,10);let r=yield function(e){return y(this,void 0,void 0,(function*(){return yield n(`event/${e}`)}))}(o);r.success?(r=r.data,document.getElementById("editEventName").value=r.eventName,document.getElementById("editEventDate").value=new Date(r.eventDate)+"",document.getElementById("editEventLocation").value=r.location,document.getElementById("editMaxBooking").value=r.maxBooking||"9999",document.getElementById("editEventDescription").value=r.description,document.getElementById("editEventId").value=r.id,document.body.style.backdropFilter="blur(5px)",$.addEventListener("submit",(e=>x(void 0,void 0,void 0,(function*(){e.preventDefault();const t=document.getElementById("editEventName").value,n=document.getElementById("editEventDate").value,r=document.getElementById("editEventLocation").value,i=parseInt(document.getElementById("editMaxBooking").value),d={eventName:t,eventDate:n,description:document.getElementById("editEventDescription").value,location:r,maxBooking:i},c=localStorage.getItem("token"),a=yield h(o,d,c);a.success?(g(document.querySelector("#errorContainer"),"Event Updated Successfully!"),k(),I.classList.add("hidden")):v(document.querySelector("#errorContainer"),a.error.message||"Event Update Failed! ")})))),I.classList.remove("hidden")):v(document.querySelector("#errorContainer"),"Event Not Found, Inform the Developer about this Bug Please!")}))))}))}else console.log("editModal or editTrigger or editCloseButton or editEventModalForm not found"),console.log("editModal "+I),console.log("editTrigger "+q),console.log("editCloseButton "+D),console.log("editEventModalForm"+$),v(document.querySelector("#errorContainer"),"Editing Form Not Properly Loaded, Inform the Developer about this Bug Please!");const A=yield c(e);let N;N=A.success?A.data:{firstName:"unable to retrieve data",lastName:"unable to retrieve data",email:"unable to retrieve data"};const M=function(e){const{firstName:t,lastName:n,email:o}=e;return`\n        <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-0">\n            <dl class="sm:divide-y sm:divide-gray-200 dark:divide-gray-700">\n                ${[{label:"First Name",id:"firstName",value:t,disabled:""},{label:"Last Name",id:"lastName",value:n,disabled:""},{label:"Email address",id:"email",value:o,disabled:"disabled"},{label:"New Password",id:"password",value:"",type:"password",disabled:""}].map((e=>`\n        <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">\n            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">${e.label}</dt>\n            <dd class="mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2">\n                <input type="${e.type||"text"}" name="${e.id}" id="${e.id}"\n                    value="${e.value}" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg\n                    focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600\n                    dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"\n                    placeholder="${e.label}" ${e.disabled}>\n            </dd>\n        </div>\n    `)).join("")}\n            </dl>\n            \n        <div class="justify-center self-auto px-4 py-3 flex bg-gray-50 dark:bg-gray-800 text-right sm:px-6">\n            <button id="editUserBtn" type="button"\n                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save\n            </button>\n        </div>\n    \n        </div>\n    `}(N),P=document.getElementById("accountContainer");P?P.innerHTML=M:console.log("accountDetailsContainer not found");const T=document.getElementById("editUserBtn");T?T.addEventListener("click",(()=>x(void 0,void 0,void 0,(function*(){const e=document.getElementById("firstName").value,t=document.getElementById("lastName").value,n=document.getElementById("email").value,o=document.getElementById("password").value;let r;r=o?{firstName:e,lastName:t,email:n,password:o}:{firstName:e,lastName:t,email:n};const c=localStorage.getItem("token"),a=yield function(e,t){return d(this,void 0,void 0,(function*(){return yield i("user",e,t)}))}(r,c);a.success?(g(document.querySelector("#errorContainer"),"User Detail Updated Successfully!"),k()):v(document.querySelector("#errorContainer"),a.error.message||"User Detail Update Failed! ")})))):console.log("editUserBtn not found");const F=document.getElementById("deleteAccountBtn");F&&F.addEventListener("click",(()=>x(void 0,void 0,void 0,(function*(){const t=yield function(e){return d(this,void 0,void 0,(function*(){return yield o("user",e)}))}(e);t.success?(g(document.querySelector("#errorContainer"),"User Deleted Successfully! Redirecting to login page..."),localStorage.removeItem("token"),setTimeout((()=>{window.location.href="/account/login.html"}),3e3)):(v(document.querySelector("#errorContainer"),t.error.message||"User Delete Failed! "),k())}))))}))))})();