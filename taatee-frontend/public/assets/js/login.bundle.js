(()=>{"use strict";var e=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function c(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,u)}s((o=o.apply(e,n||[])).next())}))};const n="http://localhost:3000/";function t(t,o,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${n}${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:o?JSON.stringify(o):void 0});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error posting data to API",e),{success:!1,error:{message:`An error occurred while connecting to the API: ${e.message||"Unknown error"}`}}}}))}function o(t){return o=this,r=void 0,c=function*(){return yield function(t,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${n}user`,{headers:{Authorization:`Bearer ${o}`}});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error fetching data from API",e),{success:!1,error:{message:"An error occurred while fetching data."}}}}))}(0,t)},new((i=void 0)||(i=Promise))((function(e,n){function t(e){try{s(c.next(e))}catch(e){n(e)}}function u(e){try{s(c.throw(e))}catch(e){n(e)}}function s(n){var o;n.done?e(n.value):(o=n.value,o instanceof i?o:new i((function(e){e(o)}))).then(t,u)}s((c=c.apply(o,r||[])).next())}));var o,r,i,c}var r=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function c(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,u)}s((o=o.apply(e,n||[])).next())}))};const i=(e="token")=>{return n=void 0,o=void 0,c=function*(){const n=localStorage[e];if(n)try{const e=yield function(e,n="auth/validate"){return r(this,void 0,void 0,(function*(){const o={token:e};return yield t(n,o)}))}(n);return!0===e.success?!0===(yield e.data).valid:(console.error("Error validating token:",e.error),!1)}catch(e){return console.error("Error validating token:",e),!1}return!1},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function u(e){try{s(c.throw(e))}catch(e){t(e)}}function s(n){var t;n.done?e(n.value):(t=n.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}s((c=c.apply(n,o||[])).next())}));var n,o,i,c};var c=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function c(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,u)}s((o=o.apply(e,n||[])).next())}))};const u=(e,n,t)=>{const o=document.createElement("a");return o.classList.add("block","px-4","py-2","text-sm","text-gray-700"),o.setAttribute("href",n),o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.setAttribute("id",t),o.innerText=e,o},s=()=>c(void 0,void 0,void 0,(function*(){const e=localStorage.getItem("token"),n=yield o(e);if(n.success){const e=n.data;if(e&&"admin"===e.role)return!0}return!1})),a=()=>c(void 0,void 0,void 0,(function*(){localStorage.removeItem("token"),window.location.href="/account/login.html"}));function d(e,n,t){e.innerHTML=`<div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4" role="alert">\n    <p class="font-bold">${t||"Error"}</p>\n    <p>${n}</p>\n  </div>`,setTimeout((()=>f(e)),3e3)}function l(e,n){e.innerHTML=`<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4" role="alert">\n    <p class="font-bold">Success</p>\n    <p>${n}</p>\n  </div>`,setTimeout((()=>f(e)),3e3)}function f(e){e.innerHTML=""}document.addEventListener("DOMContentLoaded",(()=>{c(void 0,void 0,void 0,(function*(){const e=document.querySelector("#user-menu-list");if(e)if(e.innerHTML="",yield i()){const n=window.location.pathname.includes("login.html"),t=window.location.pathname.includes("signup.html");let o;o=(yield s())?"/admin":"/user",(n||t)&&(window.location.href=o),e.appendChild(u("Your Dashboard",o,"user-menu-item-0")),e.appendChild(u("Logout","account/login.html","user-menu-item-2"));const r=document.querySelector("#user-menu-item-2");r&&r.addEventListener("click",(e=>{e.preventDefault(),a()}))}else document.querySelectorAll(".login-required").forEach((e=>{e.setAttribute("href","/account/login.html")})),e.appendChild(u("Sign In","/account/login.html","user-menu-item-0")),e.appendChild(u("Create Account","/account/signup.html","user-menu-item-1"))})),(()=>{const e=document.querySelector("#user-menu"),n=document.querySelector("#user-menu-list");e&&n&&e.addEventListener("click",(()=>{n.classList.toggle("hidden")}));const t=document.querySelector("#mobile-menu"),o=document.querySelector("#menu-toggle"),r=document.querySelector("#menu-close-btn"),i=document.querySelector("#menu-show-btn");o&&t&&r&&i&&o.addEventListener("click",(()=>{t.classList.toggle("hidden"),r.classList.toggle("hidden"),i.classList.toggle("hidden")}))})();const e=document.querySelector("#loginForm");e&&e.addEventListener("submit",(e=>{return n=void 0,o=void 0,c=function*(){if(e.preventDefault(),function(){var e,n;const t=document.querySelector("#email"),o=document.querySelector("#password"),r=function(e){return{isValid:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e),error:"Invalid email address"}}(t.value),i=function(e){return{isValid:e.length>6,error:"Password must be at least 6 characters"}}(o.value);if(r.isValid&&i.isValid)return!0;if(!r.isValid){t.classList.add("border","border-amber-700");const n=document.querySelector("#errorContainer");n&&d(n,null!==(e=r.error)&&void 0!==e?e:"Unkown error occured")}if(!i.isValid){o.classList.add("border","border-amber-700");const e=document.querySelector("#errorContainer");e&&d(e,null!==(n=r.error)&&void 0!==n?n:"Unkown error occured")}return!1}()){const e=document.querySelector("#email"),n=document.querySelector("#password"),o={email:e.value,password:n.value},i=yield function(e,n="auth/signin"){return r(this,void 0,void 0,(function*(){return yield t(n,e)}))}(o);if(i.success){const{access_token:e}=i.data;console.log("Access Token",e),localStorage.setItem("token",e),"admin"===i.data.user.role?(l(document.querySelector("#errorContainer"),"You have successfully logged in. You will be redirected to the admin page in 3 seconds."),setTimeout((()=>{window.location.href="/admin"}))):(l(document.querySelector("#errorContainer"),"You have successfully logged in. You will be redirected to the user page in 3 seconds."),setTimeout((()=>{window.location.href="/user"})))}else{const e=i.error.message,n=document.querySelector("#errorContainer");n&&d(n,e)}}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function u(e){try{s(c.throw(e))}catch(e){t(e)}}function s(n){var t;n.done?e(n.value):(t=n.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}s((c=c.apply(n,o||[])).next())}));var n,o,i,c}))}))})();