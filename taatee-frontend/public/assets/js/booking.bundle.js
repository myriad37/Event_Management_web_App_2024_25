(()=>{"use strict";var t=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{s(o.next(t))}catch(t){i(t)}}function a(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((o=o.apply(t,e||[])).next())}))};const e="http://localhost:3000/";function n(n,o){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e}${n}`,{headers:{Authorization:`Bearer ${o}`}});return t.ok?{success:!0,data:yield t.json()}:{success:!1,error:yield t.json()}}catch(t){return console.error("Error fetching data from API",t),{success:!1,error:{message:"An error occurred while fetching data."}}}}))}function o(t){return e=this,o=void 0,i=function*(){return yield n("user",t)},new((r=void 0)||(r=Promise))((function(t,n){function c(t){try{s(i.next(t))}catch(t){n(t)}}function a(t){try{s(i.throw(t))}catch(t){n(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(c,a)}s((i=i.apply(e,o||[])).next())}));var e,o,r,i}function r(n,o="auth/validate"){return r=this,i=void 0,a=function*(){const r={token:n};return yield function(n,o,r){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e}${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:o?JSON.stringify(o):void 0});return t.ok?{success:!0,data:yield t.json()}:{success:!1,error:yield t.json()}}catch(t){return console.error("Error posting data to API",t),{success:!1,error:{message:`An error occurred while connecting to the API: ${t.message||"Unknown error"}`}}}}))}(o,r)},new((c=void 0)||(c=Promise))((function(t,e){function n(t){try{s(a.next(t))}catch(t){e(t)}}function o(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof c?r:new c((function(t){t(r)}))).then(n,o)}s((a=a.apply(r,i||[])).next())}));var r,i,c,a}const i=(t="token")=>{return e=void 0,n=void 0,i=function*(){const e=localStorage[t];if(e)try{const t=yield r(e);return!0===t.success?!0===(yield t.data).valid:(console.error("Error validating token:",t.error),!1)}catch(t){return console.error("Error validating token:",t),!1}return!1},new((o=void 0)||(o=Promise))((function(t,r){function c(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,a)}s((i=i.apply(e,n||[])).next())}));var e,n,o,i};var c=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{s(o.next(t))}catch(t){i(t)}}function a(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((o=o.apply(t,e||[])).next())}))};const a=(t,e,n)=>{const o=document.createElement("a");return o.classList.add("block","px-4","py-2","text-sm","text-gray-700"),o.setAttribute("href",e),o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.setAttribute("id",n),o.innerText=t,o},s=()=>c(void 0,void 0,void 0,(function*(){const t=localStorage.getItem("token"),e=yield o(t);if(e.success){const t=e.data;if(t&&"admin"===t.role)return!0}return!1})),l=()=>c(void 0,void 0,void 0,(function*(){localStorage.removeItem("token"),window.location.href="/account/login.html"}));var u=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{s(o.next(t))}catch(t){i(t)}}function a(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((o=o.apply(t,e||[])).next())}))};function d(t){t.innerHTML=""}var f=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{s(o.next(t))}catch(t){i(t)}}function a(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(r=>f(void 0,void 0,void 0,(function*(){c(void 0,void 0,void 0,(function*(){const t=document.querySelector("#user-menu-list");if(t)if(t.innerHTML="",yield i()){const e=window.location.pathname.includes("login.html"),n=window.location.pathname.includes("signup.html");let o;o=(yield s())?"/admin":"/user",(e||n)&&(window.location.href=o),t.appendChild(a("Your Dashboard",o,"user-menu-item-0")),t.appendChild(a("Logout","account/login.html","user-menu-item-2"));const r=document.querySelector("#user-menu-item-2");r&&r.addEventListener("click",(t=>{t.preventDefault(),l()}))}else document.querySelectorAll(".login-required").forEach((t=>{t.setAttribute("href","/account/login.html")})),t.appendChild(a("Sign In","/account/login.html","user-menu-item-0")),t.appendChild(a("Create Account","/account/signup.html","user-menu-item-1"))})),(()=>{const t=document.querySelector("#user-menu"),e=document.querySelector("#user-menu-list");t&&e&&t.addEventListener("click",(()=>{e.classList.toggle("hidden")}));const n=document.querySelector("#mobile-menu"),o=document.querySelector("#menu-toggle"),r=document.querySelector("#menu-close-btn"),i=document.querySelector("#menu-show-btn");o&&n&&r&&i&&o.addEventListener("click",(()=>{n.classList.toggle("hidden"),r.classList.toggle("hidden"),i.classList.toggle("hidden")}))})();const r=new URLSearchParams(window.location.search).get("id");if(!(yield i())&&(window.location.href="/account/login.html"),!r)return void(window.location.href="/events.html");if(!localStorage.getItem("token"))return void(window.location.href="/account/login.html");const g=yield function(t,e){return u(this,void 0,void 0,(function*(){return yield n(`booking/${t}`,e)}))}(parseInt(r),localStorage.getItem("token"));if(!1===g.success)return void(window.location.href="/events.html");const h=document.querySelector("#receiptContainer");h&&(h.innerHTML=function(t){const e=t.data.user,n=t.data.event;return`\n        <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16 lg:px-6">\n            <div class="mx-auto max-w-screen-md text-center mb-8 lg:mb-12">\n                <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-gray-900 dark:text-white">Booking Receipt</h2>\n            </div>\n            <div class="space-y-8 lg:grid lg:grid-cols-1 sm:gap-4 xl:gap-8 lg:space-y-0">\n                \x3c!-- Booking Info--\x3e\n                <div class="flex flex-col p-6 mb-0 mx-auto max-w-xl text-center text-gray-900 bg-white rounded-lg border border-gray-100 shadow dark:border-gray-600 xl:px-8 dark:bg-gray-800 dark:text-white">\n                    <h3 class="mb-2 text-2xl font-semibold w-l">Booking Info</h3>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Booking ID: ${t.data.id}</p>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Booking Date: ${t.data.bookingDate}</p>\n            \n                    \x3c!-- User Info --\x3e\n                    <h3 class="mb-2 text-2xl font-semibold">Customer Info</h3>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">First Name: ${e.firstName}</p>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Last Name: ${e.lastName}</p>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Email: ${e.email}</p>\n\n                    \x3c!-- Event Info --\x3e\n                    <h3 class="mb-2 text-2xl font-semibold">Event Info</h3>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Event: ${n.eventName}</p>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Venue: ${n.location}</p>\n                    <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400">Date: ${n.eventDate}</p>\n\n                    <button id="bookingCancel" class="bg-red-500 hover:bg-red-600 mt-2 text-white font-bold py-2 px-4 rounded">\n                        Cancel Booking\n                    </button>\n                </div>\n                \n            </div>\n        </div>\n    `}(g)),o(localStorage.getItem("token")).then((t=>{!1!==t.success&&(t.data.id===g.data.user.id||(window.location.href="/events.html"))})),document.getElementById("bookingCancel").addEventListener("click",(n=>f(void 0,void 0,void 0,(function*(){n.preventDefault();const o=localStorage.getItem("token");if(!o)return void(window.location.href="/account/login.html");const r=yield function(n,o){return u(this,void 0,void 0,(function*(){return yield function(n,o){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e}${n}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});return t.ok?{success:!0}:{success:!1,error:yield t.json()}}catch(t){return console.error("Error deleting data from API",t),{success:!1,error:{message:"An error occurred while deleting data."}}}}))}(`booking/${n}`,o)}))}(g.data.id,o);if(!0===r.success)return(i=document.querySelector("#errorContainer")).innerHTML='<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4" role="alert">\n    <p class="font-bold">Success</p>\n    <p>You have successfully cancelled this booking.</p>\n  </div>',setTimeout((()=>d(i)),3e3),void setTimeout((()=>{window.location.href="/user/"}),2500);var i;const c=r.error.message,a=document.querySelector("#errorContainer");a&&function(t,e,n){t.innerHTML=`<div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4" role="alert">\n    <p class="font-bold">Error</p>\n    <p>${e}</p>\n  </div>`,setTimeout((()=>d(t)),3e3)}(a,c)}))))}))))})();