(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function i(e){try{a(o.next(e))}catch(e){c(e)}}function u(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}a((o=o.apply(e,t||[])).next())}))};const t="http://localhost:3000/";function n(n){return o=this,r=void 0,i=function*(){return yield function(n,o){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}user`,{headers:{Authorization:`Bearer ${o}`}});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error fetching data from API",e),{success:!1,error:{message:"An error occurred while fetching data."}}}}))}(0,n)},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{a(i.next(e))}catch(e){t(e)}}function u(e){try{a(i.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c((function(e){e(o)}))).then(n,u)}a((i=i.apply(o,r||[])).next())}));var o,r,c,i}function o(n,o="auth/validate"){return r=this,c=void 0,u=function*(){const r={token:n};return yield function(n,o,r){return e(this,void 0,void 0,(function*(){try{const e=yield fetch(`${t}${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:o?JSON.stringify(o):void 0});return e.ok?{success:!0,data:yield e.json()}:{success:!1,error:yield e.json()}}catch(e){return console.error("Error posting data to API",e),{success:!1,error:{message:`An error occurred while connecting to the API: ${e.message||"Unknown error"}`}}}}))}(o,r)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{a(u.next(e))}catch(e){t(e)}}function o(e){try{a(u.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,o)}a((u=u.apply(r,c||[])).next())}));var r,c,i,u}var r=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function i(e){try{a(o.next(e))}catch(e){c(e)}}function u(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}a((o=o.apply(e,t||[])).next())}))};const c=(e,t,n)=>{const o=document.createElement("a");return o.classList.add("block","px-4","py-2","text-sm","text-gray-700"),o.setAttribute("href",t),o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.setAttribute("id",n),o.innerText=e,o},i=()=>r(void 0,void 0,void 0,(function*(){const e=document.querySelector("#user-menu-list");if(e)if(e.innerHTML="",yield((e="token")=>{return t=void 0,n=void 0,c=function*(){const t=localStorage[e];if(t)try{const e=yield o(t);return!0===e.success?!0===(yield e.data).valid:(console.error("Error validating token:",e.error),!1)}catch(e){return console.error("Error validating token:",e),!1}return!1},new((r=void 0)||(r=Promise))((function(e,o){function i(e){try{a(c.next(e))}catch(e){o(e)}}function u(e){try{a(c.throw(e))}catch(e){o(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,u)}a((c=c.apply(t,n||[])).next())}));var t,n,r,c})()){const t=window.location.pathname.includes("login.html"),n=window.location.pathname.includes("signup.html");let o;o=(yield u())?"/admin":"/user",(t||n)&&(window.location.href=o),e.appendChild(c("Your Dashboard",o,"user-menu-item-0")),e.appendChild(c("Logout","account/login.html","user-menu-item-2"));const r=document.querySelector("#user-menu-item-2");r&&r.addEventListener("click",(e=>{e.preventDefault(),a()}))}else document.querySelectorAll(".login-required").forEach((e=>{e.setAttribute("href","/account/login.html")})),e.appendChild(c("Sign In","/account/login.html","user-menu-item-0")),e.appendChild(c("Create Account","/account/signup.html","user-menu-item-1"))})),u=()=>r(void 0,void 0,void 0,(function*(){const e=localStorage.getItem("token"),t=yield n(e);if(t.success){const e=t.data;if(e&&"admin"===e.role)return!0}return!1})),a=()=>r(void 0,void 0,void 0,(function*(){localStorage.removeItem("token"),window.location.href="/account/login.html"}));document.addEventListener("DOMContentLoaded",(()=>{i(),(()=>{const e=document.querySelector("#user-menu"),t=document.querySelector("#user-menu-list");e&&t&&e.addEventListener("click",(()=>{t.classList.toggle("hidden")}));const n=document.querySelector("#mobile-menu"),o=document.querySelector("#menu-toggle"),r=document.querySelector("#menu-close-btn"),c=document.querySelector("#menu-show-btn");o&&n&&r&&c&&o.addEventListener("click",(()=>{n.classList.toggle("hidden"),r.classList.toggle("hidden"),c.classList.toggle("hidden")}))})()}))})();